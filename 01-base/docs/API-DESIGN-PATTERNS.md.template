# ğŸ”Œ {{PROJECT_NAME}} - API è¨­è¨ˆæ¨¡å¼

> **ç›®çš„**: å®šç¾©çµ±ä¸€çš„ API è¨­è¨ˆæ¨™æº–å’Œæœ€ä½³å¯¦è¸
> **é©ç”¨ç¯„åœ**: æ‰€æœ‰ API ç«¯é»é–‹ç™¼
> **ç¶­è­·**: API è®Šæ›´æ™‚æ›´æ–°
> **æœ€å¾Œæ›´æ–°**: {{CURRENT_DATE}}

## ğŸ“‹ ç›®éŒ„

- [é€šç”¨è¨­è¨ˆåŸå‰‡](#é€šç”¨è¨­è¨ˆåŸå‰‡)
- [RESTful API è¦ç¯„](#restful-api-è¦ç¯„)
- [è«‹æ±‚æ ¼å¼](#è«‹æ±‚æ ¼å¼)
- [éŸ¿æ‡‰æ ¼å¼](#éŸ¿æ‡‰æ ¼å¼)
- [éŒ¯èª¤è™•ç†](#éŒ¯èª¤è™•ç†)
- [èªè­‰æˆæ¬Š](#èªè­‰æˆæ¬Š)
- [åˆ†é ](#åˆ†é )
- [éæ¿¾å’Œæ’åº](#éæ¿¾å’Œæ’åº)
- [API ç‰ˆæœ¬æ§åˆ¶](#api-ç‰ˆæœ¬æ§åˆ¶)
- [é€Ÿç‡é™åˆ¶](#é€Ÿç‡é™åˆ¶)

---

## ğŸ¯ é€šç”¨è¨­è¨ˆåŸå‰‡

### 1. RESTful è¨­è¨ˆ

éµå¾ª REST æ¶æ§‹é¢¨æ ¼ï¼š

- **è³‡æºå°å‘**: URL ä»£è¡¨è³‡æºï¼Œä¸æ˜¯å‹•ä½œ
- **HTTP æ–¹æ³•**: ä½¿ç”¨æ­£ç¢ºçš„ HTTP æ–¹æ³•
- **ç„¡ç‹€æ…‹**: æ¯å€‹è«‹æ±‚åŒ…å«æ‰€æœ‰å¿…è¦ä¿¡æ¯
- **çµ±ä¸€æ¥å£**: ä¸€è‡´çš„ URL çµæ§‹å’Œå‘½å

### 2. å‘½åè¦ç¯„

```
âœ… æ­£ç¢ºç¤ºä¾‹:
GET    /api/users              # ç²å–ç”¨æˆ¶åˆ—è¡¨
GET    /api/users/:id          # ç²å–å–®å€‹ç”¨æˆ¶
POST   /api/users              # å‰µå»ºç”¨æˆ¶
PUT    /api/users/:id          # æ›´æ–°ç”¨æˆ¶
DELETE /api/users/:id          # åˆªé™¤ç”¨æˆ¶

âŒ éŒ¯èª¤ç¤ºä¾‹:
GET    /api/getUsers           # ä¸è¦åœ¨URLä¸­ä½¿ç”¨å‹•è©
POST   /api/user/create        # è³‡æºåç¨±æ‡‰è©²ç”¨è¤‡æ•¸
PUT    /api/updateUser/:id     # å‹•è©æ‡‰è©²ç”¨HTTPæ–¹æ³•è¡¨ç¤º
```

### 3. ä¸€è‡´æ€§åŸå‰‡

- **URL çµæ§‹**: ä¿æŒçµ±ä¸€çš„ URL æ¨¡å¼
- **åƒæ•¸å‘½å**: ä½¿ç”¨ camelCase æˆ– snake_caseï¼Œå…¨å±€çµ±ä¸€
- **éŸ¿æ‡‰æ ¼å¼**: æ‰€æœ‰ API ä½¿ç”¨ç›¸åŒçš„éŸ¿æ‡‰çµæ§‹
- **éŒ¯èª¤ç¢¼**: çµ±ä¸€çš„éŒ¯èª¤ç¢¼é«”ç³»

---

## ğŸ”„ RESTful API è¦ç¯„

### HTTP æ–¹æ³•ä½¿ç”¨

| æ–¹æ³• | ç”¨é€” | å†ªç­‰æ€§ | å®‰å…¨æ€§ |
|------|------|--------|--------|
| GET | ç²å–è³‡æº | âœ… | âœ… |
| POST | å‰µå»ºè³‡æº | âŒ | âŒ |
| PUT | å®Œæ•´æ›´æ–°è³‡æº | âœ… | âŒ |
| PATCH | éƒ¨åˆ†æ›´æ–°è³‡æº | âŒ | âŒ |
| DELETE | åˆªé™¤è³‡æº | âœ… | âŒ |

### æ¨™æº– CRUD æ“ä½œ

```typescript
// åˆ—è¡¨ - GET /api/resource
GET /api/users
GET /api/users?page=1&limit=20&sort=createdAt:desc

// è©³æƒ… - GET /api/resource/:id
GET /api/users/123

// å‰µå»º - POST /api/resource
POST /api/users
Body: { "name": "John", "email": "john@example.com" }

// å®Œæ•´æ›´æ–° - PUT /api/resource/:id
PUT /api/users/123
Body: { "name": "John Doe", "email": "john@example.com" }

// éƒ¨åˆ†æ›´æ–° - PATCH /api/resource/:id
PATCH /api/users/123
Body: { "name": "John Doe" }

// åˆªé™¤ - DELETE /api/resource/:id
DELETE /api/users/123
```

### åµŒå¥—è³‡æº

```typescript
// ç²å–ç”¨æˆ¶çš„è¨‚å–®
GET /api/users/:userId/orders

// ç²å–ç”¨æˆ¶çš„ç‰¹å®šè¨‚å–®
GET /api/users/:userId/orders/:orderId

// å‰µå»ºç”¨æˆ¶çš„è¨‚å–®
POST /api/users/:userId/orders

// é™åˆ¶åµŒå¥—æ·±åº¦ (æœ€å¤š 2 å±¤)
âœ… /api/users/:userId/orders/:orderId
âŒ /api/users/:userId/orders/:orderId/items/:itemId
```

---

## ğŸ“¥ è«‹æ±‚æ ¼å¼

### Content-Type

```
JSON API (æ¨è–¦):
Content-Type: application/json

Form Data:
Content-Type: application/x-www-form-urlencoded

File Upload:
Content-Type: multipart/form-data
```

### è«‹æ±‚ç¤ºä¾‹

```typescript
// GET è«‹æ±‚ - æŸ¥è©¢åƒæ•¸
GET /api/users?status=active&role=admin&page=1&limit=20

// POST è«‹æ±‚ - JSON Body
POST /api/users
Content-Type: application/json

{
  "name": "John Doe",
  "email": "john@example.com",
  "role": "user",
  "metadata": {
    "department": "Engineering",
    "location": "Taiwan"
  }
}

// PATCH è«‹æ±‚ - éƒ¨åˆ†æ›´æ–°
PATCH /api/users/123
Content-Type: application/json

{
  "status": "inactive"
}
```

---

## ğŸ“¤ éŸ¿æ‡‰æ ¼å¼

### æˆåŠŸéŸ¿æ‡‰

#### æ¨™æº–æˆåŠŸéŸ¿æ‡‰çµæ§‹

```typescript
interface SuccessResponse<T> {
  success: true;
  data: T;
  message?: string;
  timestamp: string;
}
```

#### ç¤ºä¾‹

```json
{
  "success": true,
  "data": {
    "id": "123",
    "name": "John Doe",
    "email": "john@example.com",
    "createdAt": "2024-01-01T00:00:00Z"
  },
  "message": "User created successfully",
  "timestamp": "2024-01-01T00:00:00Z"
}
```

### åˆ—è¡¨éŸ¿æ‡‰ (å«åˆ†é )

```typescript
interface PaginatedResponse<T> {
  success: true;
  data: T[];
  pagination: {
    page: number;
    limit: number;
    total: number;
    totalPages: number;
    hasNext: boolean;
    hasPrev: boolean;
  };
  timestamp: string;
}
```

#### ç¤ºä¾‹

```json
{
  "success": true,
  "data": [
    { "id": "1", "name": "User 1" },
    { "id": "2", "name": "User 2" }
  ],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 100,
    "totalPages": 5,
    "hasNext": true,
    "hasPrev": false
  },
  "timestamp": "2024-01-01T00:00:00Z"
}
```

### HTTP ç‹€æ…‹ç¢¼

| ç‹€æ…‹ç¢¼ | å«ç¾© | ä½¿ç”¨å ´æ™¯ |
|--------|------|----------|
| 200 | OK | æˆåŠŸç²å–è³‡æº |
| 201 | Created | æˆåŠŸå‰µå»ºè³‡æº |
| 204 | No Content | æˆåŠŸåˆªé™¤è³‡æºï¼ˆç„¡è¿”å›å…§å®¹ï¼‰ |
| 400 | Bad Request | è«‹æ±‚åƒæ•¸éŒ¯èª¤ |
| 401 | Unauthorized | æœªèªè­‰ |
| 403 | Forbidden | ç„¡æ¬Šé™ |
| 404 | Not Found | è³‡æºä¸å­˜åœ¨ |
| 409 | Conflict | è³‡æºè¡çª |
| 422 | Unprocessable Entity | é©—è­‰éŒ¯èª¤ |
| 429 | Too Many Requests | é€Ÿç‡é™åˆ¶ |
| 500 | Internal Server Error | æœå‹™å™¨éŒ¯èª¤ |

---

## âŒ éŒ¯èª¤è™•ç†

### éŒ¯èª¤éŸ¿æ‡‰çµæ§‹

```typescript
interface ErrorResponse {
  success: false;
  error: {
    code: string;
    message: string;
    details?: any;
    field?: string;  // é©—è­‰éŒ¯èª¤æ™‚æŒ‡å‡ºå…·é«”å­—æ®µ
  };
  timestamp: string;
}
```

### éŒ¯èª¤ç¢¼è¦ç¯„

```typescript
// æ ¼å¼: CATEGORY_SPECIFIC_ERROR
// ç¤ºä¾‹:
AUTH_INVALID_CREDENTIALS   // èªè­‰éŒ¯èª¤
AUTH_TOKEN_EXPIRED         // TokenéæœŸ
VALIDATION_REQUIRED_FIELD  // å¿…å¡«å­—æ®µç¼ºå¤±
VALIDATION_INVALID_FORMAT  // æ ¼å¼éŒ¯èª¤
RESOURCE_NOT_FOUND         // è³‡æºä¸å­˜åœ¨
PERMISSION_DENIED          // æ¬Šé™ä¸è¶³
RATE_LIMIT_EXCEEDED        // è¶…éé€Ÿç‡é™åˆ¶
SERVER_INTERNAL_ERROR      // æœå‹™å™¨å…§éƒ¨éŒ¯èª¤
```

### éŒ¯èª¤éŸ¿æ‡‰ç¤ºä¾‹

```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_REQUIRED_FIELD",
    "message": "Email is required",
    "field": "email",
    "details": {
      "field": "email",
      "constraint": "required"
    }
  },
  "timestamp": "2024-01-01T00:00:00Z"
}
```

### é©—è­‰éŒ¯èª¤ (å¤šå€‹å­—æ®µ)

```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Validation failed",
    "details": [
      {
        "field": "email",
        "message": "Email is required"
      },
      {
        "field": "password",
        "message": "Password must be at least 8 characters"
      }
    ]
  },
  "timestamp": "2024-01-01T00:00:00Z"
}
```

---

## ğŸ” èªè­‰æˆæ¬Š

### JWT èªè­‰æµç¨‹

```typescript
// 1. ç™»å…¥ç²å– Token
POST /api/auth/login
Body: { "email": "user@example.com", "password": "password" }

Response:
{
  "success": true,
  "data": {
    "accessToken": "eyJhbGc...",
    "refreshToken": "eyJhbGc...",
    "expiresIn": 3600
  }
}

// 2. ä½¿ç”¨ Token è¨ªå•å—ä¿è­·çš„ API
GET /api/users/me
Headers: {
  "Authorization": "Bearer eyJhbGc..."
}

// 3. åˆ·æ–° Token
POST /api/auth/refresh
Body: { "refreshToken": "eyJhbGc..." }
```

### Authorization Header æ ¼å¼

```
Authorization: Bearer {access_token}
```

### èªè­‰éŒ¯èª¤

```json
{
  "success": false,
  "error": {
    "code": "AUTH_TOKEN_INVALID",
    "message": "Invalid or expired token"
  },
  "timestamp": "2024-01-01T00:00:00Z"
}
```

---

## ğŸ“„ åˆ†é 

### æŸ¥è©¢åƒæ•¸

```typescript
// Offset-based åˆ†é  (æ¨è–¦ç”¨æ–¼ä¸€èˆ¬æƒ…æ³)
GET /api/users?page=1&limit=20

// Cursor-based åˆ†é  (æ¨è–¦ç”¨æ–¼å¤§æ•¸æ“šé›†)
GET /api/users?cursor=eyJpZCI6MTIzfQ&limit=20
```

### åˆ†é éŸ¿æ‡‰

```json
{
  "success": true,
  "data": [...],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 100,
    "totalPages": 5,
    "hasNext": true,
    "hasPrev": false
  }
}
```

### é»˜èªå€¼

- **é»˜èªé ç¢¼**: page=1
- **é»˜èªæ¯é æ•¸é‡**: limit=20
- **æœ€å¤§æ¯é æ•¸é‡**: limit=100

---

## ğŸ” éæ¿¾å’Œæ’åº

### éæ¿¾

```typescript
// å–®æ¢ä»¶éæ¿¾
GET /api/users?status=active

// å¤šæ¢ä»¶éæ¿¾
GET /api/users?status=active&role=admin

// æ—¥æœŸç¯„åœéæ¿¾
GET /api/users?createdAfter=2024-01-01&createdBefore=2024-12-31

// æœç´¢
GET /api/users?search=john
```

### æ’åº

```typescript
// å–®å­—æ®µæ’åº (å‡åº)
GET /api/users?sort=createdAt

// å–®å­—æ®µæ’åº (é™åº)
GET /api/users?sort=-createdAt
// æˆ–
GET /api/users?sort=createdAt:desc

// å¤šå­—æ®µæ’åº
GET /api/users?sort=-createdAt,name
```

### å­—æ®µé¸æ“‡ (å¯é¸)

```typescript
// åªè¿”å›ç‰¹å®šå­—æ®µ
GET /api/users?fields=id,name,email

// æ’é™¤ç‰¹å®šå­—æ®µ
GET /api/users?exclude=password,token
```

---

## ğŸ”„ API ç‰ˆæœ¬æ§åˆ¶

### URL ç‰ˆæœ¬æ§åˆ¶ (æ¨è–¦)

```typescript
// ç‰ˆæœ¬ 1
GET /api/v1/users

// ç‰ˆæœ¬ 2
GET /api/v2/users
```

### Header ç‰ˆæœ¬æ§åˆ¶ (å¯é¸)

```
GET /api/users
Headers: {
  "Accept": "application/vnd.myapp.v2+json"
}
```

### ç‰ˆæœ¬ç­–ç•¥

- **ä¸»ç‰ˆæœ¬**: ä¸å…¼å®¹çš„ API è®Šæ›´
- **å‘å¾Œå…¼å®¹**: æ–°å¢å­—æ®µã€å¯é¸åƒæ•¸
- **å»¢æ£„é€šçŸ¥**: æå‰é€šçŸ¥ç‰ˆæœ¬å»¢æ£„
- **æ–‡æª”**: ç¶­è­·å¤šç‰ˆæœ¬æ–‡æª”

---

## â±ï¸ é€Ÿç‡é™åˆ¶

### Rate Limit Headers

```
X-RateLimit-Limit: 100          # æ™‚é–“çª—å£å…§çš„æœ€å¤§è«‹æ±‚æ•¸
X-RateLimit-Remaining: 95       # å‰©é¤˜è«‹æ±‚æ•¸
X-RateLimit-Reset: 1640995200   # é‡ç½®æ™‚é–“ (Unix timestamp)
```

### è¶…éé™åˆ¶çš„éŸ¿æ‡‰

```json
{
  "success": false,
  "error": {
    "code": "RATE_LIMIT_EXCEEDED",
    "message": "Too many requests. Please try again later.",
    "details": {
      "limit": 100,
      "remaining": 0,
      "resetAt": "2024-01-01T01:00:00Z"
    }
  },
  "timestamp": "2024-01-01T00:00:00Z"
}
```

### é»˜èªé™åˆ¶

- **æœªèªè­‰ç”¨æˆ¶**: 10 è«‹æ±‚/åˆ†é˜
- **å·²èªè­‰ç”¨æˆ¶**: 100 è«‹æ±‚/åˆ†é˜
- **ç‰¹æ®Šç«¯é»**: æ ¹æ“šéœ€æ±‚èª¿æ•´

---

## ğŸ“ æœ€ä½³å¯¦è¸

### 1. ä½¿ç”¨è¤‡æ•¸åè©

```
âœ… /api/users
âŒ /api/user
```

### 2. ä½¿ç”¨å°å¯«

```
âœ… /api/users
âŒ /api/Users
```

### 3. ä½¿ç”¨é€£å­—ç¬¦è€Œéä¸‹åŠƒç·š

```
âœ… /api/user-profiles
âŒ /api/user_profiles
```

### 4. ä¸è¦åœ¨ URL ä¸­ä½¿ç”¨æ–‡ä»¶å‰¯æª”å

```
âœ… /api/users
âŒ /api/users.json
```

### 5. ä½¿ç”¨æŸ¥è©¢åƒæ•¸é€²è¡Œéæ¿¾

```
âœ… /api/users?status=active
âŒ /api/users/active
```

### 6. æä¾›æœ‰æ„ç¾©çš„éŒ¯èª¤æ¶ˆæ¯

```json
âœ… {
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Email format is invalid",
    "field": "email"
  }
}

âŒ {
  "error": "Invalid input"
}
```

### 7. ä½¿ç”¨ HTTPS

æ‰€æœ‰ API ç«¯é»éƒ½æ‡‰è©²ä½¿ç”¨ HTTPSã€‚

### 8. æ–‡æª”åŒ–

æ¯å€‹ API ç«¯é»éƒ½æ‡‰è©²æœ‰å®Œæ•´çš„æ–‡æª”ï¼ŒåŒ…æ‹¬ï¼š
- è«‹æ±‚æ–¹æ³•å’Œ URL
- è«‹æ±‚åƒæ•¸
- è«‹æ±‚ç¤ºä¾‹
- éŸ¿æ‡‰ç¤ºä¾‹
- éŒ¯èª¤ç¢¼

---

## ğŸ› ï¸ å¯¦ç¾ç¤ºä¾‹

### Next.js API Route ç¤ºä¾‹

```typescript
// app/api/users/route.ts
import { NextRequest, NextResponse } from 'next/server';
import { prisma } from '@/lib/prisma';

export async function GET(request: NextRequest) {
  try {
    // è§£ææŸ¥è©¢åƒæ•¸
    const searchParams = request.nextUrl.searchParams;
    const page = parseInt(searchParams.get('page') || '1');
    const limit = parseInt(searchParams.get('limit') || '20');
    const status = searchParams.get('status');

    // æ§‹å»ºæŸ¥è©¢æ¢ä»¶
    const where = status ? { status } : {};

    // æŸ¥è©¢æ•¸æ“š
    const [users, total] = await Promise.all([
      prisma.user.findMany({
        where,
        skip: (page - 1) * limit,
        take: limit,
        orderBy: { createdAt: 'desc' }
      }),
      prisma.user.count({ where })
    ]);

    // è¿”å›æˆåŠŸéŸ¿æ‡‰
    return NextResponse.json({
      success: true,
      data: users,
      pagination: {
        page,
        limit,
        total,
        totalPages: Math.ceil(total / limit),
        hasNext: page * limit < total,
        hasPrev: page > 1
      },
      timestamp: new Date().toISOString()
    });

  } catch (error) {
    // è¿”å›éŒ¯èª¤éŸ¿æ‡‰
    return NextResponse.json({
      success: false,
      error: {
        code: 'SERVER_INTERNAL_ERROR',
        message: 'Failed to fetch users',
        details: process.env.NODE_ENV === 'development' ? error.message : undefined
      },
      timestamp: new Date().toISOString()
    }, { status: 500 });
  }
}

export async function POST(request: NextRequest) {
  try {
    const body = await request.json();

    // é©—è­‰è¼¸å…¥
    if (!body.email) {
      return NextResponse.json({
        success: false,
        error: {
          code: 'VALIDATION_REQUIRED_FIELD',
          message: 'Email is required',
          field: 'email'
        },
        timestamp: new Date().toISOString()
      }, { status: 400 });
    }

    // å‰µå»ºç”¨æˆ¶
    const user = await prisma.user.create({
      data: body
    });

    // è¿”å›æˆåŠŸéŸ¿æ‡‰
    return NextResponse.json({
      success: true,
      data: user,
      message: 'User created successfully',
      timestamp: new Date().toISOString()
    }, { status: 201 });

  } catch (error) {
    return NextResponse.json({
      success: false,
      error: {
        code: 'SERVER_INTERNAL_ERROR',
        message: 'Failed to create user',
        details: process.env.NODE_ENV === 'development' ? error.message : undefined
      },
      timestamp: new Date().toISOString()
    }, { status: 500 });
  }
}
```

---

## ğŸ“š åƒè€ƒè³‡æº

- [REST API è¨­è¨ˆæŒ‡å—](https://restfulapi.net/)
- [HTTP ç‹€æ…‹ç¢¼](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status)
- [JSON API è¦ç¯„](https://jsonapi.org/)
- [OpenAPI è¦ç¯„](https://swagger.io/specification/)

---

**ğŸ“ æç¤º**: ä¿æŒ API è¨­è¨ˆçš„ä¸€è‡´æ€§å’Œå¯é æ¸¬æ€§ï¼Œå¯ä»¥å¤§å¤§æå‡é–‹ç™¼æ•ˆç‡å’Œç”¨æˆ¶é«”é©—ã€‚
